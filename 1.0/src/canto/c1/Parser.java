package canto.c1;

import java.util.List;
import java.util.ListIterator;
import java.util.Stack;

import canto.AbstractSyntaxTree;
import canto.Token;
import canto.c1.ast.*;
import canto.c1.exception.ParserException;

public class Parser implements canto.Parser {
	
	/** ·ÇÖÕ¼«·û±àºÅ³£Á¿ */
	private static final int PROGRAM = 0;
	private static final int BLOCK = 1;
	private static final int STMTS = 2;
	private static final int DECL = 3;
	private static final int STMT = 4;
	private static final int EXPR = 5;
	private static final int TYPE = 6;
	private static final int UN_OP = 7;
	private static final int BI_OP1 = 8;
	private static final int BI_OP2 = 9;
	private static final int BI_OP3 = 10;
	private static final int BI_OP4 = 11;
	
	/** ÖÕ¼«·û±àºÅ³£Á¿ */
	private static final int END = 0;
	private static final int ID = 1;
	private static final int LITERAL = 2;
	private static final int IF = 3;
	private static final int ELSE = 4;
	private static final int WHILE = 5;
	private static final int INPUT = 6;
	private static final int OUTPUT = 7;
	private static final int INT = 8;
	private static final int L_BRACE = 9;
	private static final int R_BRACE = 10;
	private static final int L_PARENT = 11;
	private static final int R_PARENT  = 12;
	private static final int SEMI = 13;
	private static final int EQUALS = 14;
	private static final int NOT = 15;
	private static final int PLUS = 16;
	private static final int MINUS = 17;
	private static final int TIMES = 18;
	private static final int LESS = 19;
	private static final int LESS_EQUALS = 20;
	private static final int GREATER = 21;
	private static final int GREATER_EQUALS = 22;
	private static final int EQUALS_EQUALS = 23;
	private static final int NOT_EQUALS = 24;
	
	
	/** Goto±í */
	private static int[][] gotoTable = {
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬0 ²»Ê¹ÓÃ
	    {2,  3,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬1
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬2
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬3
	    {0,  0,  5,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬4
	    {0,  12, 0,  7,  8,  0,  9,  0,  0,  0,  0,  0},  // ×´Ì¬5
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬6
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬7
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬8
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬9
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬10
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬11
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬12
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬13
	    {0,  0,  0,  0,  0,  15, 0,  22, 0,  0,  0,  0},  // ×´Ì¬14
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 28, 30}, // ×´Ì¬15
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬16
	    {0,  0,  0,  0,  0,  18, 0,  22, 0,  0,  0,  0},  // ×´Ì¬17
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 28, 30}, // ×´Ì¬18
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬19
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬20
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬21
	    {0,  0,  0,  0,  0,  23, 0,  22, 0,  0,  0,  0},  // ×´Ì¬22
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬23
	    {0,  0,  0,  0,  0,  25, 0,  22, 0,  0,  0,  0},  // ×´Ì¬24
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬25
	    {0,  0,  0,  0,  0,  27, 0,  22, 0,  0,  0,  0},  // ×´Ì¬26
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 0,  0,  0},  // ×´Ì¬27
	    {0,  0,  0,  0,  0,  29, 0,  22, 0,  0,  0,  0},  // ×´Ì¬28
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 0,  0},  // ×´Ì¬29
	    {0,  0,  0,  0,  0,  31, 0,  22, 0,  0,  0,  0},  // ×´Ì¬30
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 28, 0},  // ×´Ì¬31
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬32
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬33
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬34
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬35
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬36
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬37
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬38
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬39
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬40
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬41
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬42
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬43
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬44
	    {0,  0,  0,  0,  0,  46, 0,  22, 0,  0,  0,  0},  // ×´Ì¬45
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 28, 30}, // ×´Ì¬46
	    {0,  12, 0,  0,  48, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬47
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬48
	    {0,  12, 0,  0,  50, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬49
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬50
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬51
	    {0,  0,  0,  0,  0,  53, 0,  22, 0,  0,  0,  0},  // ×´Ì¬52
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 28, 30}, // ×´Ì¬53
	    {0,  12, 0,  0,  55, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬54
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬55
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬56
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬57
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬58
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬59
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬60
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬61
	    {0,  0,  0,  0,  0,  63, 0,  22, 0,  0,  0,  0},  // ×´Ì¬62
	    {0,  0,  0,  0,  0,  0,  0,  0,  24, 26, 28, 30}, // ×´Ì¬63
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬64
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬65
	    {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬66
	};
	
	/** Action±í */
	private static int[][] actionTable = {
		{0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬0 ²»Ê¹ÓÃ
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬1
	    {-1,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬2
	    {-2,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬3
	    {0, -6, 0,  -6, 0,  -6, -6, -6, -6, -6, -6, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬4
	    {0, 13, 0,  44, 0,  51, 56, 61, 66, 4,  6,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬5
	    {-3,-3, 0,  -3, -3, -3, -3, -3, -3, -3, -3, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬6
	    {0, -4, 0,  -4, -4, -4, -4, -4, -4, -4, -4, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬7
	    {0, -5, 0,  -5, -5, -5, -5, -5, -5, -5, -5, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬8
	    {0, 10, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬9
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  11, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬10
	    {0, -7, 0,  -7, -7, -7, -7, -7, -7, -7, -7, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬11
	    {0, -8, 0,  -8, -8, -8, -8, -8, -8, -8, -8, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬12
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  14, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬13
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬14
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  16, 0,  0,  36, 37, 35, 38, 39, 40, 41, 42, 43}, // ×´Ì¬15
	    {0, -9, 0,  -9, -9, -9, -9, -9, -9, -9, -9, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬16
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬17
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  19, 0,  0,  0,  36, 37, 35, 38, 39, 40, 41, 42, 43}, // ×´Ì¬18
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -17,-17,0,  0,  -17,-17,-17,-17,-17,-17,-17,-17,-17},// ×´Ì¬19
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -15,-15,0,  0,  -15,-15,-15,-15,-15,-15,-15,-15,-15},// ×´Ì¬20
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -16,-16,0,  0,  -16,-16,-16,-16,-16,-16,-16,-16,-16},// ×´Ì¬21
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬22
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -18,-18,0,  0,  -18,-18,-18,-18,-18,-18,-18,-18,-18},// ×´Ì¬23
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬24
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -19,-19,0,  0,  -19,-19,-19,-19,-19,-19,-19,-19,-19},// ×´Ì¬25
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬26
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -20,-20,0,  0,  -20,-20,35, -20,-20,-20,-20,-20,-20},// ×´Ì¬27
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬28
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -21,-21,0,  0,  32, 33, 35, -21,-21,-21,-21,-21,-21},// ×´Ì¬29
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬30
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  -22,-22,0,  0,  32, 33, 35, 38, 39, 40, 41, 22, 22}, // ×´Ì¬31
	    {0, -24,-24,0,  0,  0,  0,  0,  0,  0,  0,  -24,0,  0,  0,  -24,-24,-24,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬32
	    {0, -25,-25,0,  0,  0,  0,  0,  0,  0,  0,  -25,0,  0,  0,  -25,-25,-25,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬33
	    {0, -26,-26,0,  0,  0,  0,  0,  0,  0,  0,  -26,0,  0,  0,  -26,-26,-26,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬34
	    {0, -27,-27,0,  0,  0,  0,  0,  0,  0,  0,  -27,0,  0,  0,  -27,-27,-27,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬35
	    {0, -28,-28,0,  0,  0,  0,  0,  0,  0,  0,  -28,0,  0,  0,  -28,-28,-28,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬36
	    {0, -29,-29,0,  0,  0,  0,  0,  0,  0,  0,  -29,0,  0,  0,  -29,-29,-29,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬37
	    {0, -30,-30,0,  0,  0,  0,  0,  0,  0,  0,  -30,0,  0,  0,  -30,-30,-30,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬38
	    {0, -31,-31,0,  0,  0,  0,  0,  0,  0,  0,  -31,0,  0,  0,  -31,-31,-31,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬39
	    {0, -32,-32,0,  0,  0,  0,  0,  0,  0,  0,  -32,0,  0,  0,  -32,-32,-32,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬40
	    {0, -33,-33,0,  0,  0,  0,  0,  0,  0,  0,  -33,0,  0,  0,  -33,-33,-33,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬41
	    {0, -34,-34,0,  0,  0,  0,  0,  0,  0,  0,  -34,0,  0,  0,  -34,-34,-34,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬42
	    {0, -35,-35,0,  0,  0,  0,  0,  0,  0,  0,  -35,0,  0,  0,  -35,-35,-35,0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬43
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  45, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬44
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬45
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  47, 0,  0,  0,  36, 37, 35, 38, 39, 40, 41, 42, 43}, // ×´Ì¬46
	    {0, 13, 0,  44, 0,  51, 56, 61, 0,  4,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬47
	    {0, -10,0,  -10,49, -10,-10,-10,-10,-10,-10,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬48
	    {0, 13, 0,  44, 0,  51, 56, 61, 0,  4,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬49
	    {0, -11,0,  -11,-11,-11,-11,-11,-11,-11,-11,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬50
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  52, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬51
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬52
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  54, 0,  0,  0,  36, 37, 35, 38, 39, 40, 41, 42, 43}, // ×´Ì¬53
	    {0, 13, 0,  44, 0,  51, 56, 61, 0,  4,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬54
	    {0, -12,0,  -12,-12,-12,-12,-12,-12,-12,-12,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬55
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  57, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬56
	    {0, 58, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬57
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  59, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬58
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  60, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬59
	    {0, -13,0,  -13,-13,-13,-13,-13,-13,-13,-13,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬60
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  62, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬61
	    {0, 20, 21, 0,  0,  0,  0,  0,  0,  0,  0,  17, 0,  0,  0,  34, 32, 33, 0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬62
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  64, 0,  0,  0,  36, 37, 35, 38, 39, 40, 41, 42, 43}, // ×´Ì¬63
	    {0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  65, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬64
	    {0, -14,0,  -14,-14,-14,-14,-14,-14,-14,-14,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬65
	    {0, -23,0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},  // ×´Ì¬66
	};
	
	/** AST¸ù½áµã */
	private AbstractSyntaxTree treeRoot;
	/** TokenÁ´ */
	private List<Token> tokenList;
	/** AST½áµãÕ» */
	private Stack<Object> symbolStack;
	/** ×´Ì¬Õ» */ 
	private Stack<Integer> stateStack;
	/** Tokenµü´úÆ÷ */
	private ListIterator<Token> tokenIterator;
	/** µ±Ç°Token */
	private Token nowToken;

	
	@Override
	public AbstractSyntaxTree getAbstractSyntaxTree() {
		return treeRoot;
	}

	@Override
	public void open(List<Token> tokenList) {
		this.tokenList = tokenList;
	}

	@Override
	public AbstractSyntaxTree parse() throws ParserException {
		tokenIterator = tokenList.listIterator();
		symbolStack = new Stack<Object>();
		stateStack = new Stack<Integer>();
		int state = 1;
		int terminal = nextTerminal();
		int nonterminal;
		// ½«³õÊ¼×´Ì¬ºÅÑ¹Õ»
		stateStack.push(state);
		while (true) {
			// ´ÓAction±íÖÐ²éÕÒ¶¯×÷£¬²¢ÒÀ´Ë½øÐÐ²Ù×÷
			int action = actionTable[state][terminal];
			if (action == -1) {
			// ³É¹¦
				break;
			} else if (action == 0) {
			// ´íÎó
				throw new ParserException();
			} else if (action > 0) {
			// ÒÆÈë
				// ×´Ì¬×ªÒÆ
				state = action;
				// ½«ÐÂ×´Ì¬ºÅÑ¹Õ»
				stateStack.push(state);
				symbolStack.push(nowToken);
				// »ñÈ¡ÏÂÒ»¸öÖÕ¼«·û
				terminal = nextTerminal();
			} else {
			// ¹éÔ¼
				// ¸ù¾Ý²úÉúÊ½±àºÅ½øÐÐ¹éÔ¼
				int production_no = -action;
				switch (production_no) {
				case 2 :
					reduceProgram();
					nonterminal = PROGRAM;
					break;
				case 3 :
					reduceBlock();
					nonterminal = BLOCK;
					break;
				case 4 :
					reduceStmts();
					nonterminal = STMTS;
					break;
				case 5 :
					reduceStmts();
					nonterminal = STMTS;
					break;
				case 6 :
					reduceNullStmts();
					nonterminal = STMTS;
					break;
				case 7 :
					reduceDeclaration();
					nonterminal = DECL;
					break;	
				case 8 :
					reduceBlockStatement();
					nonterminal = STMT;
					break;
				case 9 :
					reduceAssignmentStatement();
					nonterminal = STMT;
					break;
				case 10 :
					reduceIfStatement();
					nonterminal = STMT;
					break;
				case 11 :
					reduceIfElseStatment();
					nonterminal = STMT;
					break;
				case 12 :
					reduceWhileStatement();
					nonterminal = STMT;
					break;
				case 13 :
					reduceInputStatement();
					nonterminal = STMT;
					break;
				case 14 :
					reduceOutputStatement();
					nonterminal = STMT;
					break;
				case 15 :
					reduceIdentifier();
					nonterminal = EXPR;
					break;
				case 16 :
					reduceLiteral();
					nonterminal = EXPR;
					break;
				case 17 :
					reduceParenthesisExpression();
					nonterminal = EXPR;
					break;
				case 18 :
					reduceUnaryExpression();
					nonterminal = EXPR;
					break;
				case 19 :
					reduceBinaryExpression();
					nonterminal = EXPR;
					break;
				case 20 :
					reduceBinaryExpression();
					nonterminal = EXPR;
					break;
				case 21 :
					reduceBinaryExpression();
					nonterminal = EXPR;
					break;
				case 22 :
					reduceBinaryExpression();
					nonterminal = EXPR;
					break;
				case 23 :
					reduceType(PrimitiveType.INTEGER);
					nonterminal = TYPE;
					break;
				case 24 :
					reduceUnaryOperator(UnaryOperator.POSITIVE);
					nonterminal = UN_OP;
					break;
				case 25 :
					reduceUnaryOperator(UnaryOperator.NEGTIVE);
					nonterminal = UN_OP;
					break;
				case 26 :
					reduceUnaryOperator(UnaryOperator.NOT);
					nonterminal = UN_OP;
					break;
				case 27 :
					reduceBinaryOperator(BinaryOperator.TIMES);
					nonterminal = BI_OP1;
					break;
				case 28 :
					reduceBinaryOperator(BinaryOperator.PLUS);
					nonterminal = BI_OP2;
					break;
				case 29 :
					reduceBinaryOperator(BinaryOperator.MINUS);
					nonterminal = BI_OP2;
					break;
				case 30 :
					reduceBinaryOperator(BinaryOperator.LESS);
					nonterminal = BI_OP3;
					break;
				case 31 :
					reduceBinaryOperator(BinaryOperator.LESS_EQUALS);
					nonterminal = BI_OP3;
					break;
				case 32 :
					reduceBinaryOperator(BinaryOperator.GREATER);
					nonterminal = BI_OP3;
					break;
				case 33 :
					reduceBinaryOperator(BinaryOperator.GREATER_EQUALS);
					nonterminal = BI_OP3;
					break;
				case 34 :
					reduceBinaryOperator(BinaryOperator.EQUALS);
					nonterminal = BI_OP4;
					break;
				case 35 :
					reduceBinaryOperator(BinaryOperator.NOT_EQUALS);
					nonterminal = BI_OP4;
					break;
				default:
					throw new ParserException();
				}
				state = stateStack.peek();
				state = gotoTable[state][nonterminal];
				if (state == 0) {
					throw new ParserException();
				}
				// ½«ÐÂ×´Ì¬ºÅÑ¹Õ»
				stateStack.push(state);
			}
		}
		treeRoot = (AbstractSyntaxTree) symbolStack.pop();
		return treeRoot;
	}
	
	/**
	 * ´ÓTokenÁ´ÖÐ»ñÈ¡ÏÂÒ»¸öÖÕ¼«·û
	 * @return Èç¹ûTokenÁ´ÖÐÏÂÒ»¸öÖÕ¼«·û¶ÔÓ¦µÄ±àºÅ
	 * @throws ParserException 
	 */
	private int nextTerminal() throws ParserException {
		if (tokenIterator.hasNext()) {
			// »ñÈ¡ÏÂÒ»¸öÖÕ¼«·ûµÄÐÅÏ¢
			nowToken = tokenIterator.next();
			int type = nowToken.getType();
			String lexeme = nowToken.getLexeme();
			// ÅÐ¶Ï¸ÃÖÕ¼«·ûµÄ±àºÅ
			switch (type) {
			case canto.c1.Token.ID :
				return ID;
			case canto.c1.Token.CONSTANT :
				return LITERAL;
			case canto.c1.Token.KEYWORD :				
				if (lexeme.equals("if")) {
					return IF;
				} else if (lexeme.equals("else")) {
					return ELSE;
				} else if (lexeme.equals("while")) {
					return WHILE;
				} else if (lexeme.equals("input")) {
					return INPUT;
				} else if (lexeme.equals("output")) {
					return OUTPUT;
				} else if (lexeme.equals("int")) {
					return INT;
				}
			case canto.c1.Token.PUNCTUATION :
				if (lexeme.equals("{")) {
					return L_BRACE;
				} else if (lexeme.equals("}")) {
					return R_BRACE;
				} else if (lexeme.equals("(")) {
					return L_PARENT;
				} else if (lexeme.equals(")")) {
					return R_PARENT;
				} else if (lexeme.equals(";")) {
					return SEMI;
				}
			case canto.c1.Token.OPERERATOR :
				if (lexeme.equals("=")) {
					return EQUALS;
				} else if (lexeme.equals("!")) {
					return NOT;
				} else if (lexeme.equals( "+")) {
					return PLUS;
				} else if (lexeme.equals("-")) {
					return MINUS;
				} else if (lexeme.equals("*")) {
					return TIMES;
				} else if (lexeme.equals("<")) {
					return LESS;
				} else if (lexeme.equals("<=")) {
					return LESS_EQUALS;
				} else if (lexeme.equals(">")) {
					return GREATER;
				} else if (lexeme.equals(">=")) {
					return GREATER_EQUALS;
				} else if (lexeme.equals("==")) {
					return EQUALS_EQUALS;
				} else if (lexeme.equals("!=")) {
					return NOT_EQUALS;
				}
			default :
				throw new ParserException();
			}
		} else {
			return END;			
		}
	}
	
	/**
	 * 2ºÅ²úÉúÊ½
	 * PROGRAM -> BLOCK
	 */
	private void reduceProgram() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Block block = (Block) symbolStack.pop();
		// ´´½¨Program½áµã²¢Ñ¹Õ»
		symbolStack.push(new Program(block));
		// ×´Ì¬ÏòÉÏ»ØÍË1²ã
		stateStack.pop();
	}
	
	/**
	 * 3ºÅ²úÉúÊ½
	 *   BLOCK -> { STMTS }
	 */
	private void reduceBlock() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		Block block = (Block) symbolStack.pop();
		symbolStack.pop();
		// STMTSÒÑÊÇBlock½áµã£¬Ö±½Ó½«ÆäÔÙÑ¹»ØÕ»ÖÐ
		symbolStack.push(block);
		// ×´Ì¬ÏòÉÏ·µ»Ø3²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 4ºÅ²úÉúÊ½
	 *   STMTS -> STMTS DECL
	 * 5ºÅ²úÉúÊ½
	 *   STMTS -> STMTS STMT
	 */
	private void reduceStmts() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Blockable blockable = (Blockable) symbolStack.pop();
		Block block = (Block) symbolStack.peek();
		// ÏòÕ»¶¥µÄBlock½áµãÌí¼ÓÄÚÈÝ
		block.addBlockable(blockable);
		// ×´Ì¬ÏòÉÏ·µ»Ø2²ã
		stateStack.pop();
		stateStack.pop();
	}

	/**
	 * 6ºÅ²úÉúÊ½
	 *   STMTS -> ¦Å
	 */
	private void reduceNullStmts() {
		// ¸Ã²úÉúÊ½½öÔÚSTMTSµÄÊ×²¿·¢Éú£¬ÔÚ´Ë´¦´´½¨Block½áµã²¢Ñ¹Õ»
		symbolStack.push(new Block());
	}
	
	/**
	 * 7ºÅ²úÉúÊ½
	 *   DECL -> TYPE id ;
	 */
	private void reduceDeclaration() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		Token token = (Token) symbolStack.pop();
		Type type = (Type) symbolStack.pop();
		// ´´½¨Declaration½áµã²¢Ñ¹Õ»
		symbolStack.push(new Declaration(type, 
				new Identifier(token.getLexeme())));
		// ×´Ì¬ÏòÉÏ·µ»Ø3²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 8ºÅ²úÉúÊ½
	 *   STMT -> BLOCK
	 */
	private void reduceBlockStatement() {
		// BlockÒÑÊÇSTMTµÄ´ú±í£¬²»×öÕ»²Ù×÷
		// ×´Ì¬ÏòÉÏ·µ»Ø1²ã
		stateStack.pop();
	}

	/**
	 * 9ºÅ²úÉúÊ½
	 *   STMT -> id = EXPR ;
	 */
	private void reduceAssignmentStatement() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		Expression expr = (Expression) symbolStack.pop();
		symbolStack.pop();
		Token token = (Token) symbolStack.pop();
		// ´´½¨AssignmentStatement½áµã²¢Ñ¹Õ»
		symbolStack.push(new AssignmentStatement(
				new Identifier(token.getLexeme()), expr));
		// ×´Ì¬ÏòÉÏ·µ»Ø4²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 10ºÅ²úÉúÊ½
	 *   STMT -> if ( EXPR ) STMT
	 */
	private void reduceIfStatement() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Statement stmt = (Statement) symbolStack.pop();
		symbolStack.pop();
		Expression expr = (Expression) symbolStack.pop();
		symbolStack.pop();
		symbolStack.pop();
		// ´´½¨IfStatement½áµã²¢Ñ¹Õ»
		symbolStack.push(new IfStatement(expr, stmt));
		// ×´Ì¬ÏòÉÏ·µ»Ø5²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 11ºÅ²úÉúÊ½
	 *   STMT -> ( EXPR ) STMT else STMT
	 */
	private void reduceIfElseStatment() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Statement elseStmt = (Statement) symbolStack.pop();
		symbolStack.pop();
		Statement thenStmt = (Statement) symbolStack.pop();
		symbolStack.pop();
		Expression expr = (Expression) symbolStack.pop();
		symbolStack.pop();
		symbolStack.pop();
		// ´´½¨IfStatement½áµã²¢Ñ¹Õ»
		symbolStack.push(new IfStatement(expr, thenStmt, elseStmt));
		// ×´Ì¬ÏòÉÏ·µ»Ø7²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 12ºÅ²úÉúÊ½
	 *   STMT -> while ( EXPR ) STMT
	 */
	private void reduceWhileStatement() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Statement stmt = (Statement) symbolStack.pop();
		symbolStack.pop();
		Expression expr = (Expression) symbolStack.pop();
		symbolStack.pop();
		symbolStack.pop();
		// ´´½¨WhileStatement½áµã²¢Ñ¹Õ»
		symbolStack.push(new WhileStatement(expr, stmt));
		// ×´Ì¬ÏòÉÏ·µ»Ø5²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 13ºÅ²úÉúÊ½
	 *   STMT -> input ( id ) ;
	 */
	private void reduceInputStatement() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		symbolStack.pop();
		Token token = (Token) symbolStack.pop();
		symbolStack.pop();
		symbolStack.pop();
		// ´´½¨InputStatement½áµã²¢Ñ¹Õ»
		symbolStack.push(new InputStatement(new Identifier(token.getLexeme())));
		// ×´Ì¬ÏòÉÏ·µ»Ø5²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 14ºÅ²úÉúÊ½
	 *   STMT -> output ( EXPR ) ;
	 */
	private void reduceOutputStatement() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		symbolStack.pop();
		Expression expr = (Expression) symbolStack.pop();
		symbolStack.pop();
		symbolStack.pop();
		// ´´½¨OutputStatement½áµã²¢Ñ¹Õ»
		symbolStack.push(new OutputStatement(expr));
		// ×´Ì¬ÏòÉÏ·µ»Ø5²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 15²úÉúÊ½
	 *   EXPR -> id
	 */
	private void reduceIdentifier() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Token token = (Token) symbolStack.pop(); 
		// ´´½¨Identifier½áµã²¢Ñ¹Õ»
		symbolStack.push(new Identifier(token.getLexeme()));
		// ×´Ì¬ÏòÉÏ·µ»Ø1²ã
		stateStack.pop();
	}
	
	/**
	 * 16ºÅ²úÉúÊ½
	 *   EXPR -> literal
	 */
	private void reduceLiteral() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Token token = (Token) symbolStack.pop();
		// ´´½¨Literal½áµã²¢Ñ¹Õ»
		symbolStack.push(new IntegerLiteral((Integer)token.getAttribute()));
		// ×´Ì¬ÏòÉÏ·µ»Ø1²ã
		stateStack.pop();
	}
	
	/**
	 * 17ºÅ²úÉúÊ½
	 *   EXPR -> ( EXPR )
	 */
	private void reduceParenthesisExpression() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		Expression expression = (Expression) symbolStack.pop();
		symbolStack.pop();
		// ²»´´½¨ÐÂµÄAST½áµã£¬Ö±½Ó½«Ô­½áµãÑ¹Õ»
		symbolStack.push(expression);
		// ×´Ì¬ÏòÉÏ·µ»Ø3²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 18ºÅ²úÉúÊ½
	 *   EXPR -> UN_OP EXPR
	 */
	private void reduceUnaryExpression() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Expression expr = (Expression) symbolStack.pop();
		UnaryOperator unOp = (UnaryOperator) symbolStack.pop();
		// ´´½¨UnaryOperator½áµã²¢Ñ¹Õ»
		symbolStack.push(new UnaryExpression(unOp, expr));
		// ×´Ì¬ÏòÉÏ·µ»Ø2²ã
		stateStack.pop();
		stateStack.pop();
	}
	
	/**
	 * 19ºÅ²úÉúÊ½
	 *   EXPR -> EXPR BI_OP1 EXPR
	 * 20ºÅ²úÉúÊ½
	 *   EXPR -> EXPR BI_OP2 EXPR
	 * 21ºÅ²úÉúÊ½
	 *   EXPR -> EXPR BI_OP3 EXPR
	 * 22ºÅ²úÉúÊ½
	 *   EXPR -> EXPR BI_OP4 EXPR
	 */
	private void reduceBinaryExpression() {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		Expression rightExpr = (Expression) symbolStack.pop();
		BinaryOperator biOp = (BinaryOperator) symbolStack.pop();
		Expression leftExpr = (Expression) symbolStack.pop();
		// ´´½¨BinaryOperator½áµã²¢Ñ¹Õ»
		symbolStack.push(new BinaryExpression(biOp, leftExpr, rightExpr));
		// ×´Ì¬ÏòÉÏ·µ»Ø3²ã
		stateStack.pop();
		stateStack.pop();
		stateStack.pop();
	}

	/**
	 * 23ºÅ²úÉúÊ½
	 *   TYPE -> int
	 * @param type ÀàÐÍ±àºÅ
	 */
	private void reduceType(int type) {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		// ´´½¨Type½áµã²¢Ñ¹Õ»
		symbolStack.push(new PrimitiveType(type));
		// ×´Ì¬ÏòÉÏ·µ»Ø1²ã
		stateStack.pop();
	}
	
	/**
	 * 24-26ºÅ²úÉúÊ½
	 *   UN_OP -> + 
	 *   UN_OP -> - 
	 *   UN_OP -> !
	 * @param op µ¥Ôª²Ù×÷·û±àºÅ
	 */
	private void reduceUnaryOperator(int op) {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		// ´´½¨UnaryOperatorType½áµã²¢Ñ¹Õ»
		symbolStack.push(new UnaryOperator(op));
		// ×´Ì¬ÏòÉÏ·µ»Ø1²ã
		stateStack.pop();
	}
	
	/**
	 * 27-35ºÅ²úÉúÊ½
	 *   BI_OP1 -> *
	 *   BI_OP2 -> + 
	 *   BI_OP2 -> - 
	 *   BI_OP3 -> < 
	 *   BI_OP3 -> <= 
	 *   BI_OP3 -> > 
	 *   BI_OP3 -> >= 
	 *   BI_OP4 -> == 
	 *   BI_OP4 -> != 
	 * @param op ¶þÔª²Ù×÷·û±àºÅ
	 */
	private void reduceBinaryOperator(int op) {
		// µ¯³ö²úÉúÊ½ÓÒ²àµÄ·ûºÅ
		symbolStack.pop();
		// ´´½¨BinaryOperatorType½áµã²¢Ñ¹Õ»
		symbolStack.push(new BinaryOperator(op));
		// ×´Ì¬ÏòÉÏ·µ»Ø1²ã
		stateStack.pop();
	}
	
}
